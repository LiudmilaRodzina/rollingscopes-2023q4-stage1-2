var p=Object.defineProperty;var C=(s,e,t)=>e in s?p(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(C(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const N="http://localhost:3000/garage",A=async()=>{try{const s=await fetch(N);if(!s.ok)throw new Error;return await s.json()}catch(s){return alert("Failed to fetch cars. Please try again later"),Promise.reject(s)}},u={makes:["Tesla","Ford","Chevrolet","BMW","Toyota","Honda","Mercedes-Benz","Audi","Nissan","Subaru"],models:["Model S","Mustang","Camaro","X5","Corolla","Civic","E-Class","A4","GT-R","WRX"]},h="/liudmilarodzina-JSFE2023Q4/async-race/assets/car-eNsIunRE.svg",m=7,T=100,R=/fill="#[0-9A-Fa-f]{6}"/g,o={GARAGE_CONTAINER:"garage-container",WINNERS_CONTAINER:"winners-container",HEADER:"header",MAIN:"main",CAR_CONTAINER:"car-container",BUTTONS_PAGINATION:"buttons-pagination",CAR_NAME:"car-name"},g={BUTTON_WINNERS:"button-winners",BUTTON_GARAGE:"button-garage",BUTTON_GENERATE:"button-generate"},l={GENERATE_CARS:"GENERATE CARS",TO_WINNERS:"TO WINNERS",TO_GARAGE:"TO GARAGE",PREV_PAGE:"<< Previous Page",NEXT_PAGE:"Next Page >>"};class i{constructor(e){d(this,"navigateToWinners");d(this,"totalCars",0);d(this,"currentPage",1);this.navigateToWinners=e}displayGarage(){this.currentPage=1;const e=document.createElement("div");e.classList.add(o.GARAGE_CONTAINER),document.body.innerHTML="",document.body.append(e);const t=document.createElement("div");t.classList.add(o.HEADER),e.append(t),t.innerHTML=`
    <h2>Garage (${this.totalCars})</h2>
    <p>Page #${this.currentPage}</p>
  `;const n=document.createElement("button");n.id=g.BUTTON_WINNERS,n.textContent=l.TO_WINNERS,n.addEventListener("click",()=>{this.navigateToWinners.navigate()});const a=document.createElement("button");a.id=g.BUTTON_GENERATE,a.textContent=l.GENERATE_CARS,a.addEventListener("click",()=>{this.generateRandomCars(T)});const r=document.createElement("div");r.classList.add("main"),e.append(r),t.append(a,n),this.displayCars()}async displayCars(){try{const e=await A();this.totalCars=e.length;const t=document.querySelector(`.${o.MAIN}`);this.displayPaginationButtons();const n=e.map(a=>i.renderCar(a));t.append(...n),this.updateTotalCarsCount(),this.updatePageNumber(),this.updateVisibilityOfCars()}catch(e){console.error("An error occurred:",e)}}displayPaginationButtons(){const e=document.querySelector(`.${o.MAIN}`),t=document.createElement("div");t.classList.add(o.BUTTONS_PAGINATION),e.append(t);const n=document.createElement("button");n.textContent=l.PREV_PAGE,n.addEventListener("click",()=>{this.currentPage>1&&(this.currentPage-=1,this.updateVisibilityOfCars(),this.updatePageNumber())});const a=document.createElement("button");a.textContent=l.NEXT_PAGE,a.addEventListener("click",()=>{const r=Math.ceil(this.totalCars/m);this.currentPage<r&&(this.currentPage+=1,this.updateVisibilityOfCars(),this.updatePageNumber())}),t.append(n,a)}updateVisibilityOfCars(){document.querySelector(`.${o.GARAGE_CONTAINER}`).querySelectorAll(`.${o.CAR_CONTAINER}`).forEach((n,a)=>{const r=n;r.style.display="none",a>=(this.currentPage-1)*m&&a<this.currentPage*m&&(r.style.display="flex")})}updatePageNumber(){const e=document.querySelector(`.${o.GARAGE_CONTAINER} p`);e&&(e.textContent=`Page #${this.currentPage}`)}updateTotalCarsCount(){const e=document.querySelector(`.${o.GARAGE_CONTAINER} h2`);e&&(e.textContent=`Garage (${this.totalCars})`)}static renderCar(e){const t=document.createElement("div");return t.classList.add(o.CAR_CONTAINER),i.renderCarName(e.name,t),i.renderCarImage(e,t),t}static renderCarName(e,t){const n=document.createElement("span");n.textContent=e,n.classList.add(o.CAR_NAME),t.append(n)}static async renderCarImage(e,t){try{const a=await(await fetch(h)).text(),r=i.updateSvgFillColor(a,e.color),E=new DOMParser().parseFromString(r,"image/svg+xml").documentElement;t.append(E)}catch(n){console.error("An error occurred:",n)}}static updateSvgFillColor(e,t){return e.replace(R,`fill="${t}"`)}generateRandomCars(e){const t=Array.from({length:e},()=>i.generateRandomCar()),n=document.querySelector(`.${o.MAIN}`),a=t.map(c=>i.renderCar(c));n.append(...a),this.totalCars+=e,this.updateTotalCarsCount();const r=Math.ceil(this.totalCars/m);this.currentPage>r&&(this.currentPage=r),this.updatePageNumber(),this.updateVisibilityOfCars()}static generateRandomCar(){const e=u.makes[Math.floor(Math.random()*u.makes.length)],t=u.models[Math.floor(Math.random()*u.models.length)],n=`#${Math.floor(Math.random()*16777215).toString(16)}`;return{name:`${e} ${t}`,color:n}}}class f{constructor(e){d(this,"navigateToGarage");this.navigateToGarage=e}displayWinners(){const e=document.createElement("div");e.classList.add(o.WINNERS_CONTAINER),document.body.innerHTML="",document.body.append(e),e.innerHTML=`
      <h2>Winners (0)</h2>
      <p>Page #1</p>
    `;const t=document.createElement("button");t.id=g.BUTTON_GARAGE,t.textContent=l.TO_GARAGE,t.addEventListener("click",()=>{this.navigateToGarage.navigate()}),e.append(t)}}class y{constructor(){let e,t;const n=()=>{t.displayWinners()},a=()=>{e.displayGarage()};e=new i({navigate:n}),t=new f({navigate:a}),e.displayGarage()}}new y;
